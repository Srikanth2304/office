package com.sc.wrb.controller;

import com.sc.wrb.dto.StepFormMappingDTO;
import com.sc.wrb.model.StepFormMapping;
import com.sc.wrb.model.pk.StepFormPK;
import com.sc.wrb.service.inter.StepFormMappingService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Optional;

@RestController
@RequestMapping("/processapi/stepform")
public class StepFormController {

    @Autowired
    StepFormMappingService stepFormMappingService;


    @GetMapping("/getStepFormDefinitionById")
    public StepFormMappingDTO getStepFormMappingById(String processid, String stepname) {
        if (processid != null && stepname != null) {
            Optional<StepFormMappingDTO> stepFormMappingDTO = stepFormMappingService.getStepFormMappingById(processid, stepname);
            if (stepFormMappingDTO.isPresent()) {
                return stepFormMappingDTO.get();
            } else {
                return new StepFormMappingDTO(
                        processid,
                        stepname,
                        "No form data available for the given process ID and step name"
                );
            }
        } else {
            return new StepFormMappingDTO(
                    processid,
                    stepname,
                    "ProcessId or StepName is null"
            );
        }
    }


    @PostMapping("/saveStepFormDefinition")
    public String saveStepFormDefinition(String processId,String stepName,String form) throws Exception {
        StepFormMappingDTO stepFormMappingDTO = new StepFormMappingDTO(processId, stepName, form);
        return stepFormMappingService.saveStepFormDefinition(stepFormMappingDTO);
    }
}
