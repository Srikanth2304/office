import React, { useRef, useState } from 'react';
import '@scdevkit/form/elements/form-editor.js';

const Draft = () => {
  const formEditorRef = useRef(null);
  const [processId, setProcessId] = useState('');
  const [stepName, setStepName] = useState('');

  const handleSubmit = () => {
    if (!processId.trim() || !stepName.trim()) {
      console.log('‚ö†Ô∏è Process ID and Step Name are required.');
      return;
    }

    if (!formEditorRef.current) {
      console.log('‚ö†Ô∏è Form editor is not ready.');
      return;
    }

    const code = formEditorRef.current.getCode();
    const data = formEditorRef.current.getData();

    const formPayload = {
      code,
      data,
    };

    const escapedForm = JSON.stringify(formPayload).replace(/"/g, '\\"');

    const query = `
      mutation {
        saveStepFormDefinition(
          processId: "${processId}",
          stepName: "${stepName}",
          form: "${escapedForm}"
        )
      }
    `;

    console.log('‚úÖ Process ID:', processId);
    console.log('‚úÖ Step Name:', stepName);
    console.log('üì¶ Form Data (combined code + data):', formPayload);
    console.log('üì§ Final GraphQL query to backend:\n', query);
  };

  return (
    <div style={{ padding: '24px', fontFamily: 'sans-serif' }}>
      <h2 style={{ marginBottom: '16px' }}>Form Designer</h2>

      <div style={{ marginBottom: '16px' }}>
        <input
          type="text"
          placeholder="Enter Process ID"
          value={processId}
          onChange={(e) => setProcessId(e.target.value)}
          style={{ marginRight: '12px', padding: '6px 12px', width: '220px' }}
        />

        <input
          type="text"
          placeholder="Enter Step Name"
          value={stepName}
          onChange={(e) => setStepName(e.target.value)}
          style={{ marginRight: '12px', padding: '6px 12px', width: '220px' }}
        />

        <button
          onClick={handleSubmit}
          style={{
            padding: '8px 20px',
            backgroundColor: '#007bff',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
          }}
        >
          Submit
        </button>
      </div>

      <sc-form-editor ref={formEditorRef}></sc-form-editor>
    </div>
  );
};

export default Draft;
